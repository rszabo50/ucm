# UCM - Urwid Connection Manager

## Quick Start

UCM provides a terminal-based interface for managing SSH connections and Docker containers.

### Views

* **SSH View** - Manage and connect to SSH hosts
* **Docker View** - Access running Docker containers
* **Tmux View** - Navigate tmux windows (only visible inside tmux)
* **Swarm View** - Docker Swarm services (if configured)

Switch views using the radio buttons in the header or Tab + arrow keys.

## Keyboard Shortcuts

### Global Shortcuts (All Views)

* `q` - Quit UCM
* `?` - Show this help dialog
* `,` - Open Settings dialog
* `Ctrl+L` - Refresh screen and recalculate layout (use after resizing terminal)
* `Tab` - Cycle between UI elements
* `Esc` - Close dialogs

### Navigation

* `↑` or `k` - Move up one row
* `↓` or `j` - Move down one row
* `Page Up` - Scroll up one page
* `Page Down` - Scroll down one page
* `Home` - Jump to first item
* `End` - Jump to last item

### Actions

#### SSH View
* `Enter` - Connect to selected SSH host
* `c` - Connect to selected SSH host (new tab in iTerm2)
* `|` - Connect in vertical split pane (iTerm2 only)
* `-` - Connect in horizontal split pane (iTerm2 only)
* `f` - Toggle favorite status (marked with ★)
* `F` - Filter to show only favorites
* `r` - Sort by recently used
* `L` - Quick connect to last used connection
* `i` - Show connection info
* `Double-click` - Quick connect (mouse)

#### Docker View
* `Enter` - Connect to container
* `c` - Connect to selected container (new tab in iTerm2)
* `|` - Connect in vertical split pane (iTerm2 only)
* `-` - Connect in horizontal split pane (iTerm2 only)
* `i` - Inspect container details
* `Double-click` - Quick connect (mouse)

#### Docker Swarm View
* `c` or `b` - Connect with bash
* `s` - Connect with sh
* `i` - Inspect service/container

#### Tmux View
* `Enter` - Switch to selected window
* `c` - Switch to selected window
* `x` - Close selected window (cannot close active window)
* `r` - Refresh window list
* `Double-click` - Switch to window (mouse)

### Filtering and Sorting

* `/` - Activate filter mode (label shows "Filter [/]:" when active)
* Type text to search connections when filter is active
* `Esc` - Deactivate filter mode and return to list navigation
* Filter works on: name, address, user, category (SSH)
* Filter works on: container ID, name, image (Docker)
* `Backspace` - Remove filter characters
* `Ctrl+U` - Clear entire filter text
* `F` - Toggle favorites-only filter (shows [FAV] when active)
* `r` - Toggle recently used sorting (shows [RECENT] when active)

**Note**: The filter requires explicit activation with `/` to prevent accidental text entry. This allows you to use keyboard shortcuts (f, r, L, etc.) without accidentally typing in the filter box.

## Mouse Controls

* **Click** - Select a connection/container
* **Double-click** - Connect immediately
* **Click buttons** - Activate buttons (Help, Quit)
* **Click radio buttons** - Switch between views
* **Scroll wheel** - Scroll through lists

## SSH Configuration

Edit `~/.ucm/ssh_connections.yml` to add SSH connections.

### Required Fields
* `name` - Unique identifier
* `address` - Hostname or IP address

### Optional Fields
* `user` - SSH username (default: current user)
* `port` - SSH port (default: 22)
* `identity` - Path to SSH key file
* `options` - Additional SSH options
* `category` - Grouping label

### Example Configuration

```yaml
# Minimal connection
- name: webserver
  address: web.example.com

# Full configuration
- name: production-db
  address: db.example.com
  user: admin
  port: 2222
  identity: ~/.ssh/prod-key.pem
  options: -X
  category: production
```

## Connection History and Favorites

UCM automatically tracks your connection usage and allows marking favorites.

### History Tracking
* All connections are recorded with timestamps and use counts
* History is limited to the last 100 connections
* Most frequently used connections are tracked
* View stats and history in `~/.ucm/history.yml`

### Favorites
* Press `f` to toggle favorite status on any SSH connection
* Favorites are marked with a ★ symbol in the list
* Favorites persist across sessions
* Stored in `~/.ucm/favorites.yml`

### Benefits
* Quickly identify your most-used connections
* Mark important servers as favorites for easy identification
* Track connection patterns and usage

## Settings and Terminal Integration

Press `,` (comma) to open the Settings dialog where you can configure:

### Terminal Integration Options
* **None** (default) - UCM exits after each connection
* **Tmux** - Keep UCM open, launch connections in tmux windows
* **iTerm2** (macOS) - Keep UCM open, launch connections in iTerm2 tabs

### Tmux Settings
* Connection mode: New Window (only window mode is supported)
* Auto-name windows with connection info

### iTerm2 Settings
* Connection modes: New Tab (`c` key) or Split Pane (`|` for vertical, `-` for horizontal)
* Specify iTerm2 profile to use

Settings are saved to `~/.ucm/config.yml` and take effect immediately.

## Tmux Keyboard Shortcuts

When using UCM inside tmux, you can use the Tmux View to navigate windows without memorizing tmux shortcuts. However, here are the essential tmux key sequences for reference:

### Basic Navigation
* `Ctrl+b 0-9` - Switch to window by number (0-9)
* `Ctrl+b n` - Next window
* `Ctrl+b p` - Previous window
* `Ctrl+b w` - List all windows (interactive chooser)
* `Ctrl+b l` - Switch to last window

### Window Management
* `Ctrl+b c` - Create new window
* `Ctrl+b ,` - Rename current window
* `Ctrl+b &` - Kill current window (prompts for confirmation)
* `Ctrl+b f` - Find window by name

### Pane Management
* `Ctrl+b %` - Split pane vertically
* `Ctrl+b "` - Split pane horizontally
* `Ctrl+b o` - Switch to next pane
* `Ctrl+b ;` - Switch to last active pane
* `Ctrl+b x` - Kill current pane (prompts for confirmation)
* `Ctrl+b z` - Toggle pane zoom (fullscreen)
* `Ctrl+b {` - Move pane left
* `Ctrl+b }` - Move pane right
* `Ctrl+b ↑↓←→` - Resize pane in direction

### Session Management
* `Ctrl+b d` - Detach from session
* `Ctrl+b s` - List sessions (interactive chooser)
* `Ctrl+b $` - Rename current session

### Other Useful Commands
* `Ctrl+b ?` - Show all key bindings
* `Ctrl+b :` - Enter tmux command mode
* `Ctrl+b [` - Enter copy mode (scroll back buffer)
* `Ctrl+b ]` - Paste from tmux buffer

**Note**: All tmux shortcuts start with the prefix key `Ctrl+b`. Press the prefix, release, then press the command key.

**Mac Users**: Use the Control key (not Command ⌘) for `Ctrl+b`. The Control key is typically in the bottom left of your keyboard.

**UCM Auto-Setup**: When UCM starts inside tmux, it automatically creates a `Ctrl+b u` keybinding to return to UCM from any window. No more memorizing window numbers!

**Pro Tip**: With UCM's Tmux View, you can skip most window navigation shortcuts (`Ctrl+b 0-9`, `Ctrl+b w`, etc.) and use UCM's familiar vim-style interface instead!

## Docker Integration

UCM automatically detects running Docker containers.

### Requirements
* Docker installed and running
* User has permission to run `docker ps`

### Container Actions
* `c` - Connect with bash/sh
* `i` - View container details
* `Enter` - Quick connect

UCM tries `bash` first, then falls back to `sh` if bash isn't available.

## Tips and Tricks

### Faster Navigation
* Use `j`/`k` (Vim-style) instead of arrow keys
* Filter to narrow down the list quickly
* Use `Tab` to move between UI sections
* Inside tmux: Use Tmux View instead of `Ctrl+b` shortcuts

### Efficient Filtering
* Press `/` to activate filter mode, then type partial names
* Example: "web" finds "webserver1", "webserver2"
* Use categories to group connections
* Clear filter with `Ctrl+U` or press `Esc` to exit filter mode

### SSH Config Integration
* UCM respects `~/.ssh/config` settings
* Set common options there to avoid repetition
* Identity files, ports, and options can be configured globally

### Command-Line Options

```bash
# Show version
ucm --version

# Use custom config directory
ucm --config-dir ~/my-configs

# Enable debug logging
ucm --log-level DEBUG

# Custom log file
ucm --log-file ~/ucm.log
```

## Common Workflows

### Quick Connect
1. Launch UCM
2. Press `/` to activate filter
3. Type to find host
4. Press Enter when filtered to one result

### Container Access
1. Switch to Docker view (click or Tab)
2. Find container (filter if needed)
3. Press `c` or `Enter` to connect

### Multiple Environments
* Use `--config-dir` for separate configs
* Create aliases: `alias ucm-prod='ucm --config-dir ~/.ucm-prod'`

### Using UCM with Tmux
1. Start tmux session: `tmux` or `tmux attach`
2. Launch UCM - the Tmux View tab appears automatically
3. UCM automatically sets up `Ctrl+b u` to return to UCM from any window
4. Connect to SSH/Docker - opens in new tmux window
5. Switch to Tmux View to see all windows and navigate
6. Press `Ctrl+b u` from any window to instantly return to UCM
7. Press `Ctrl+L` to refresh screen if needed (also recalculates layout after resize)

### Using UCM with iTerm2 (macOS)
1. Launch UCM in iTerm2
2. Open Settings (press `,`) and select iTerm2 integration
3. Optionally configure your preferred iTerm2 profile
4. Connect options:
   - Press `c` to open in new iTerm2 tab
   - Press `|` to open in vertical split pane (side-by-side)
   - Press `-` to open in horizontal split pane (top-bottom)
5. UCM stays running in the original tab/pane
6. Use `Cmd+1`, `Cmd+2`, etc. to switch between tabs
7. Return to UCM tab to select your next connection

**Tip**: You can customize the iTerm2 profile used for connections in Settings. This allows you to use different color schemes, fonts, or other preferences for your SSH/Docker connections.

## Troubleshooting

### Configuration Errors
* Check error message on startup
* Verify required fields (name, address)
* Validate port range (1-65535)

### Connection Issues
* Test SSH manually: `ssh user@host`
* Check SSH key permissions: `chmod 600 ~/.ssh/key.pem`
* Enable debug logging: `ucm --log-level DEBUG`

### Docker Not Showing
* Verify Docker is running: `docker ps`
* Check user permissions: add user to docker group
* Ensure Docker is in PATH

## Documentation

* **Full User Guide**: See USER_GUIDE.md in repository
* **Development**: See DEVELOPMENT.md for contributing
* **Issues**: https://github.com/rszabo50/ucm/issues

## License

Released under GNU GPLv3.

If you find UCM useful, please donate to your local charities!

## About

UCM is inspired by nccm (NCurses ssh Connection Manager) but built with urwid for enhanced mouse support and modern terminal UI.

**Repository**: https://github.com/rszabo50/ucm

---

Press `Esc` or click `Cancel` to close this help dialog
